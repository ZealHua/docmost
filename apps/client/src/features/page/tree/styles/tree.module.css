/* ─── Tree shell ─────────────────────────────────────────────────────────── */

.tree {
  border-radius: 0;
}

.treeContainer {
  height: 100%;
  min-width: 0;

  > div,
  > div > .tree {
    height: 100% !important;
  }
}

/* ─── Row ────────────────────────────────────────────────────────────────── */

[role="treeitem"] {
  padding-bottom: 2px;
}

.row {
  white-space: nowrap;
  cursor: pointer;
}

.row:focus {
  outline: none;
}

/* ─── Node base ──────────────────────────────────────────────────────────── */

.node {
  position: relative;
  border-radius: 6px;
  display: flex;
  align-items: center;
  height: 100%;
  width: 93%;
  text-decoration: none;
  font-family: 'Sora', system-ui, sans-serif;

  color: light-dark(
    rgba(30, 10, 60, 0.72),
    rgba(220, 210, 255, 0.62)    /* --quantum-text-body at lower opacity */
  );

  transition:
    background 0.18s ease,
    color      0.18s ease,
    box-shadow 0.18s ease;
}

/* ─── Node hover ─────────────────────────────────────────────────────────── */

.node:hover {
  background: light-dark(
    rgba(147, 112, 255, 0.07),   /* violet ghost instead of grey-3 */
    rgba(147, 112, 255, 0.09)
  );
  color: light-dark(
    rgba(109, 40, 217, 0.9),
    rgba(220, 210, 255, 0.82)
  );
}

/* ─── Actions (revealed on hover) ───────────────────────────────────────── */

.node .actions {
  visibility: hidden;
  position: absolute;
  height: 100%;
  top: 0;
  right: 0;
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
  display: flex;
  align-items: center;
  padding-right: 4px;

  /* Fade in from the right — matches bubble/chip entrance feel */
  opacity: 0;
  transform: translateX(4px);
  transition: opacity 0.18s ease, transform 0.18s ease;

  background: light-dark(
    linear-gradient(90deg, transparent, rgba(243, 238, 255, 0.95) 30%),
    linear-gradient(90deg, transparent, rgba(22, 14, 56, 0.92) 30%)
  );
}

.node:hover .actions {
  visibility: visible;
  opacity: 1;
  transform: translateX(0);
}

/* ─── Drop target ────────────────────────────────────────────────────────── */

.node:global(.willReceiveDrop) {
  background: light-dark(
    rgba(147, 112, 255, 0.1),
    rgba(109, 40, 217, 0.18)
  );
  border: 1px dashed rgba(147, 112, 255, 0.4);
  box-shadow: inset 0 0 0 0 rgba(147, 112, 255, 0);
  animation: dropPulse 1.2s ease-in-out infinite;
}

@keyframes dropPulse {
  0%, 100% { box-shadow: inset 0 0 8px rgba(147, 112, 255, 0.08); }
  50%       { box-shadow: inset 0 0 16px rgba(147, 112, 255, 0.18); }
}

/* ─── Selected state ─────────────────────────────────────────────────────── */
/*
  Replaces the flat grey selected with a glowing violet surface —
  same language as .bubble.user and the thinking block .wrapperActive.
*/

.node:global(.isSelected) {
  border-radius: 0;

  background: light-dark(
    rgba(147, 112, 255, 0.11),
    rgba(109, 40, 217, 0.18)
  );

  color: light-dark(
    rgba(109, 40, 217, 0.95),
    rgba(220, 210, 255, 0.9)
  );

  /* Left accent bar — same ::after bar on .answer-card */
  box-shadow:
    inset 2px 0 0 rgba(147, 112, 255, 0.7),  /* left violet bar */
    inset 0 0 12px rgba(109, 40, 217, 0.06);
}

.node:global(.isSelectedStart.isSelectedEnd) {
  border-radius: 6px;
}

/* ─── Focused row → selected / focused node ─────────────────────────────── */

.row:focus .node:global(.isSelected),
.row:focus .node:global(.isFocused) {
  background: light-dark(
    rgba(147, 112, 255, 0.16),
    rgba(109, 40, 217, 0.26)
  );

  color: light-dark(
    rgba(109, 40, 217, 1),
    rgba(232, 222, 255, 0.95)
  );

  /* Intensify left bar + add outer glow ring — same .inputPill:focus-within ring */
  box-shadow:
    inset 2px 0 0 #9370ff,
    0 0 0 1px rgba(147, 112, 255, 0.22),
    0 2px 12px rgba(109, 40, 217, 0.2),
    inset 0 0 16px rgba(109, 40, 217, 0.08);

  outline: none;
}

/* ─── Icon ───────────────────────────────────────────────────────────────── */

.icon {
  margin: 0 10px;
  flex-shrink: 0;
  color: light-dark(
    rgba(147, 112, 255, 0.55),
    rgba(167, 139, 250, 0.55)
  );
  transition: color 0.18s ease, transform 0.18s ease;
}

/* Icon brightens on hover / selection */
.node:hover .icon {
  color: light-dark(
    rgba(109, 40, 217, 0.85),
    rgba(196, 176, 255, 0.85)
  );
}

.node:global(.isSelected) .icon,
.row:focus .node:global(.isFocused) .icon {
  color: light-dark(#7c3aed, #a78bfa);
}

/* ─── Text label ─────────────────────────────────────────────────────────── */

.text {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: var(--mantine-font-size-sm);
  font-weight: 500;
  letter-spacing: 0.01em;
  transition: color 0.18s ease;
}

/* Selected text gets the shimmer gradient — same .emptyTitle / .label mechanic */
.node:global(.isSelected) .text,
.row:focus .node:global(.isFocused) .text {
  background: linear-gradient(
    90deg,
    #7c3aed 0%,
    #c4b5fd 45%,
    #a78bfa 60%,
    #7c3aed 100%
  );
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: nodeShimmer 3.5s linear infinite;
}

@keyframes nodeShimmer {
  0%   { background-position: -200% center; }
  100% { background-position:  200% center; }
}

/* ─── Expand/collapse arrow ──────────────────────────────────────────────── */

.arrow {
  display: flex;
  color: light-dark(
    rgba(147, 112, 255, 0.4),
    rgba(167, 139, 250, 0.35)
  );
  transition:
    transform 0.28s cubic-bezier(0.34, 1.2, 0.64, 1),  /* same chevron spring */
    color     0.18s ease;
}

.node:hover .arrow {
  color: light-dark(
    rgba(109, 40, 217, 0.7),
    rgba(196, 176, 255, 0.65)
  );
}

/* ─── Scrollbar — same 3px violet thumb as .text scrollbar ──────────────── */

.treeContainer ::-webkit-scrollbar       { width: 3px; height: 3px; }
.treeContainer ::-webkit-scrollbar-track { background: transparent; }
.treeContainer ::-webkit-scrollbar-thumb {
  background: var(--quantum-scrollbar-thumb, rgba(147, 112, 255, 0.25));
  border-radius: 2px;
}
.treeContainer ::-webkit-scrollbar-thumb:hover {
  background: var(--quantum-scrollbar-thumb-hover, rgba(147, 112, 255, 0.5));
}

/* ─── Reduced Motion ──────────────────────────────────────────────────────── */

@media (prefers-reduced-motion: reduce) {
  .node:global(.isSelected) .text,
  .row:focus .node:global(.isFocused) .text {
    animation: none;
  }

  .node,
  .icon,
  .arrow {
    transition-duration: 0.01ms !important;
  }

  .node:global(.willReceiveDrop) {
    animation: none;
  }
}